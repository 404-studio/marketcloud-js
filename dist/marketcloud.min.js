/*

*	Marketcloud Javascript SDK
*   http://www.marketcloud.it
*
*	Copyright (c) 2016 Herapi SRLS
*
*	info@marketcloud.it
*

*/
(function(){function k(){!0===window.DEBUG&&console.log(Array.prototype.slice.call(arguments))}function n(c,a,b){var d="",e;for(e in c)b&&a[b]&&0!==a[b].indexOf(c[e])&&(d+=b),d=a[e]?d+e:d+("["+e+"]"),c[e]instanceof Array?d+=n(c[e],a,e):c[e]instanceof Object?d+=n(c[e],a):(d+="="+c[e],d+="&");return d}function r(){try{return new XMLHttpRequest}catch(c){}try{return new ActiveXObject("Msxml3.XMLHTTP")}catch(c){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(c){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(c){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(c){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}return null}
var t={data:{},set:function(c,a){this.data[c]=a},get:function(c){return this.data[c]},del:function(c){delete this.data[c]}},u={set:function(c,a){window.localStorage.setItem(c,JSON.stringify(a))},get:function(c){return(c=window.localStorage.getItem(c))?JSON.parse(c):c},del:function(c){window.localStorage.removeItem(c)}},v={set:function(c,a){var b=new Date;b.setTime(b.getTime()+31536E6);b="; expires="+b.toGMTString();document.cookie=c+"="+a+b+"; path=/"},get:function(c){c+="=";for(var a=document.cookie.split(";"),
b=0,d=a.length;b<d;b++){for(var e=a[b];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(c))return e.substring(c.length,e.length)}return null},del:function(c){this.set(c,"")}},l=function(){var c;try{c="localStorage"in window&&null!==window.localStorage}catch(b){c=!1}if(c)this.storage=u;else{var a;try{a=!0===navigator.cookieEnabled}catch(b){a=!1}a?this.storage=v:(console.hasOwnProperty("warn")?console.warn("This browser does not support  either LocalStorage or Cookies. Falling back to an in-memory store."):
console.log("This browser does not support  either LocalStorage or Cookies. Falling back to an in-memory store."),this.storage=t)}};l.prototype.get=function(c){return this.storage.get(c)};l.prototype.set=function(c,a){return this.storage.set(c,a)};l.prototype.del=function(c){return this.storage.del(c)};var h=function(c){var a=new r;a.open(c.method,c.url,!0);a.onreadystatechange=function(){if(4===a.readyState)if(3<Number(a.status.toString()[0])){if(c.hasOwnProperty("error")){if("function"!==typeof c.error)throw Error("error must be function");
k(JSON.parse(a.responseText));c.error(JSON.parse(a.responseText),a.status)}}else if(c.hasOwnProperty("success")){if("function"!==typeof c.success)throw Error("success must be function");k(JSON.parse(a.responseText));c.success(JSON.parse(a.responseText),a.status)}};a.setRequestHeader("Content-Type","application/json");if(c.hasOwnProperty("headers"))for(var b in c.headers)a.setRequestHeader(b,c.headers[b]);k("Firing "+c.method+" "+c.url,c);c.hasOwnProperty("data")?a.send(JSON.stringify(c.data)):a.send()},
e=function(c,a,b,f){b={success:b,error:f,headers:{}};b.headers.Authorization=d.token?d["public"]+":"+d.token:d["public"];0>c.indexOf("http://")&&(b.url=d.baseUrl+c);0<Object.keys(a).length&&(c=b.url,a=n(a,a),a=encodeURI(a.substring(0,a.length-1).split(" ").join("+")),b.url=c+("?"+a));b.method="GET";return h(b)},m=function(c,a,b){a={success:a,error:b,headers:{}};a.headers.Authorization=d.token?d["public"]+":"+d.token:d["public"];0>c.indexOf("http://")&&(a.url=d.baseUrl+c);a.method="DELETE";return h(a)},
g=function(c,a,b,f){a={success:b,error:f,data:a,headers:{}};a.headers.Authorization=d.token?d["public"]+":"+d.token:d["public"];0>c.indexOf("http://")&&(a.url=d.baseUrl+c);a.method="POST";return h(a)},p=function(c,a,b,f){a={success:b,error:f,data:a,headers:{}};a.headers.Authorization=d.token?d["public"]+":"+d.token:d["public"];0>c.indexOf("http://")&&(a.url=d.baseUrl+c);a.method="PATCH";return h(a)},q=function(c,a,b,f){a={success:b,error:f,data:a,headers:{}};a.headers.Authorization=d.token?d["public"]+
":"+d.token:d["public"];0>c.indexOf("http://")&&(a.url=d.baseUrl+c);a.method="PUT";return h(a)},w="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this,d={"public":null,token:null,baseUrl:"http://api.marketcloud.it/v0",storage:new l,getToken:function(){d.token||(d.token=d.storage.get("marketcloud.access_token"));return d.token},setToken:function(c){if("string"!==typeof c)throw Error("Token must be string.");d.token=c;d.storage.set("marketcloud.access_token",
c)},forgetToken:function(){d.token=null;d.storage.del("marketcloud.access_token")},setPublicKey:function(c){if("string"!==typeof c)throw Error("Public key must be string.");d["public"]=c},getPublicKey:function(){return d["public"]},addresses:{},brands:{},carts:{},categories:{},currencies:{},orders:{},products:{},shippings:{},stores:{},taxes:{},users:{}};d.brands.list=function(c,a){e("/brands",c||{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.brands.getById=function(c,a){e("/brands/"+
c,{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.addresses.create=function(c,a){g("/addresses/",c,function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.addresses.update=function(c,a,b){q("/addresses/"+c,a,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.addresses["delete"]=function(c,a){m("/addresses/"+c,function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.addresses.list=function(c,a){e("/addresses",c||{},function(b){a(null,b.data)},function(b){a(b.errors[0],
null)})};d.addresses.getById=function(c,a){e("/addresses/"+c,{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.categories.list=function(c,a){e("/categories",c||{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.categories.getById=function(c,a){e("/categories/"+c,{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.currencies.list=function(c,a){e("/currencies",c||{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.currencies.getById=
function(c,a){e("/currencies/"+c,{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.orders.create=function(c,a){g("/orders/",c,function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.orders.list=function(c,a){e("/orders",c||{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.orders.getById=function(c,a){e("/orders/"+c,{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.products.list=function(c,a){e("/products",c||{},function(b){a(null,b.data)},
function(b){a(b.errors[0],null)})};d.products.getById=function(c,a){e("/products/"+c,{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.shippings.list=function(c,a){e("/shippings",c||{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.shippings.getById=function(c,a){e("/shippings/"+c,{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.stores.create=function(c,a){g("/stores/",c,function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.stores.update=
function(c,a,b){q("/stores/"+c,a,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.stores["delete"]=function(c,a){m("/stores/"+c,function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.stores.list=function(c,a){e("/stores",c||{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.stores.getById=function(c,a){e("/stores/"+c,function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.taxes.list=function(c,a){e("/taxes",c||{},function(b){a(null,b.data)},function(b){a(b.errors[0],
null)})};d.taxes.getById=function(c,a){e("/taxes/"+c,{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.users.create=function(c,a){g("/users/",c,function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.users.update=function(c,a,b){q("/users/"+c,a,function(a){b(null,a.data)},function(a){b(a.errors[0],null)})};d.users["delete"]=function(c,a){m("/users/"+c,function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.users.list=function(c,a){e("/users",c||{},function(b){a(null,
b.data)},function(b){a(b.errors[0],null)})};d.users.getById=function(c,a){e("/users/"+c,{},function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.users.isLoggedIn=function(){return d.token?!0:!1};d.users.getCurrent=function(c){if(d.token)e("/users/current",{},function(a){c(null,a.data)},function(a){c(a.errors[0],null)});else throw k("Called users.getCurrent without a token"),Error("Cannot get current user information without a user access token. Obtain a user access token first.");};d.users.authenticate=
function(c,a,b){d.token=null;d.user=null;g("/users/authenticate",{password:a,email:c},function(a){d.setToken(a.data.token);d.user=a.data.user;b(null,a.data)},function(a){b(a.errors[0],null)})};d.users.authenticateWithFacebook=function(c,a,b){g("/users/authenticate/facebook",{access_token:a,user_id:c},function(a){d.setToken(a.data.token);d.user=a.data.user;b(null,a.data)},function(a){b(a.errors[0],null)})};d.carts.create=function(c,a){var b=null,b=c instanceof Array?{items:c}:c;g("/carts",b,function(b){a(null,
b.data)},function(b){a(b.errors[0],null)})};d.carts.add=function(c,a,b){if(a instanceof Array)p("/carts/"+c,{op:"add",items:a},function(a){b(null,a.data)},function(a){b(a.errors[0],null)});else throw Error("addToCart(cart_id,data,callback) data must be an array [{product_id :1,quantity : 7}]");};d.carts.remove=function(c,a,b){if(a instanceof Array)p("/carts/"+c,[{op:"remove",items:a}],function(a){b(null,a.data)},function(a){b(a.errors[0],null)});else throw Error("removeFromCart(cart_id,data,callback) data must be an array [{product_id :1,product_id : 7}]");
};d.carts.update=function(c,a,b){if(a instanceof Array)p("/carts/"+c,[{op:"update",items:a}],function(a){b(null,a.data)},function(a){b(a.errors[0],null)});else throw Error("removeFromCart(cart_id,data,callback) data must be an array [{product_id :1,product_id : 7}]");};d.carts.getCurrent=function(c){var a=d.storage.get("marketcloud.cart_id");if(a)e("/carts/"+a,{},function(a){c(null,a.data)},function(a){c(a.errors[0],null)});else return null};d.carts.getById=function(c,a){e("/carts/"+c,{},function(b){a(null,
b.data)},function(b){a(b.errors[0],null)})};d.carts.getByUser=function(c){if(null===d.user)throw Error("Cannot get current user's cart without a user access token. You need to authenticate the user first.");e("/carts",{},function(a){c(null,a.data)},function(a){c(a.errors[0],null)})};d.carts["delete"]=function(c,a){m("/carts/"+c,function(b){a(null,b.data)},function(b){a(b.errors[0],null)})};d.carts.checkout=function(c,a){if(!c.hasOwnProperty("cart_id")&&!c.hasOwnProperty("items")&&!d.storage.get("marketcloud.cart_id"))throw Error("marketcloud.carts.checkout(data,callback) missing cart data, provide cart_id or items array.");
return d.orders.create(c,a)};d.token=d.getToken();console.log("Found and existing token",d.token);w.marketcloud=d})();